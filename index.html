
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç‹¸æ—¥èªãƒ»å­¸å“¡ç³»çµ±</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="./favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="./favicon-16x16.png">
<link rel="manifest" href="./site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #FFFFFF; font-weight: bold; font-size: 18px; }
        .card-container { border: 2px solid #F3F4F6; padding: 2rem; border-radius: 36px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-zoom { background-color: #2D8CFF; color: white; padding: 1.25rem; border-radius: 1.25rem; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .teacher-box { background-color: #F3F4F6; border: 2px dashed #D1D5DB; padding: 1.5rem; border-radius: 24px; margin: 1.5rem 0; }
        .history-item { color: #9CA3AF; font-size: 13px; font-weight: normal; padding: 4px 0; border-bottom: 1px solid #F9FAFB; }
        details summary { cursor: pointer; color: #9CA3AF; font-size: 14px; margin-top: 15px; outline: none; }
    </style>
</head>
<body class="p-6">
    <div class="max-w-md mx-auto text-center">
        <h1 class="text-3xl font-bold mb-8">å°ç‹¸æ—¥èªå­¸å“¡ãƒ¼<br>èª²å‹™èˆ‡ç¹³è²»ç³»çµ±</h1>
        <div id="login-box" class="card-container">
            <input type="email" id="login-email" placeholder="æ‚¨çš„ Email" class="w-full p-4 mb-4 border-2 rounded-2xl outline-none text-center font-bold">
            <button onclick="checkStatus('login_record')" class="w-full bg-blue-400 text-white p-4 rounded-2xl shadow-lg font-bold">é€²å…¥ç³»çµ±</button>
        </div>
        <div id="status-box" class="hidden">
            <div class="card-container border-blue-400 bg-blue-50/30 mb-6">
                <button onclick="enterZoom()" class="btn-zoom text-xl font-bold">ğŸ“¹ é€²å…¥ Zoom æ•™å®¤</button>
            </div>
            <div class="card-container mb-6">
                <div class="text-6xl text-blue-600 mb-4 font-bold"><span id="res-used">0</span> / <span id="res-total">0</span></div>
                <div class="teacher-box">
                    <p class="text-gray-500 text-xs mb-3 font-bold">â›” è€å¸«å°ˆç”¨å€ï¼Œå­¸å“¡å‹¿å‹•å–”ï¼</p>
                    <button onclick="teacherAction('manual_deduct')" class="w-full bg-gray-400 text-white p-2 rounded-xl mb-2 text-sm font-bold">æ‰‹å‹•æ‰£èª² (æ› èª²/é²åˆ°)</button>
                    <button onclick="teacherAction('add_lesson')" class="w-full bg-gray-200 text-gray-600 p-2 rounded-xl text-sm font-bold">ğŸ çå‹µåŠ èª²</button>
                </div>
                <div class="text-left mt-4">
                    <p class="text-gray-400 text-xs mb-2 font-normal">ğŸ•’ æœ¬æœŸç´€éŒ„ï¼š</p>
                    <div id="res-history"></div>
                    <details class="mt-4"><summary>ğŸ“ æŸ¥è©¢èˆŠæœŸæ•¸ç´€éŒ„</summary><div id="res-old-history" class="text-xs font-normal text-gray-400 mt-2 bg-gray-50 p-3 rounded-xl leading-relaxed"></div></details>
                </div>
            </div>
        </div>
    </div>
    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbzBdcBZFOiga-L5CP0c4fiXTKMY5qVVTPiA47Wdt3VruMD9xRVDQqH2Gw-nvi2kpLd-/exec";
        const ZOOM_LINK = "https://zoom.us/j/93019761780";
        async function checkStatus(action) {
            const email = document.getElementById('login-email').value.trim();
            const res = await fetch(`${GAS_URL}?email=${encodeURIComponent(email)}&action=${action || ''}`);
            const data = await res.json();
            if(data.status === "success") {
                localStorage.setItem('korri_student_email', email);
                document.getElementById('res-used').innerText = data.used;
                document.getElementById('res-total').innerText = data.total;
                document.getElementById('res-history').innerHTML = data.history.filter(h => h.trim() !== "").map(h => `<div class="history-item">${h}</div>`).join('');
                document.getElementById('res-old-history').innerHTML = data.oldHistory.length > 0 ? data.oldHistory.map(h => `<div>${h.replace(/\\n/g, '<br>')}</div>`).join('') : "å°šç„¡èˆŠç´€éŒ„";
                document.getElementById('login-box').classList.add('hidden');
                document.getElementById('status-box').classList.remove('hidden');
            }
        }
        async function enterZoom() {
            const email = localStorage.getItem('korri_student_email');
            await fetch(`${GAS_URL}?email=${encodeURIComponent(email)}&action=zoom_checkin`);
            window.open(ZOOM_LINK, '_blank');
            setTimeout(() => checkStatus(), 2000);
        }
        async function teacherAction(action) {
            if(!confirm("ç¢ºå®šåŸ·è¡Œï¼Ÿ")) return;
            const email = localStorage.getItem('korri_student_email');
            await fetch(`${GAS_URL}?email=${encodeURIComponent(email)}&action=${action}`);
            checkStatus();
        }
    </script>
</body>
</html>
