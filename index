
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ç‹¸æ—¥èªãƒ»å­¸å“¡èª²å‹™å…¥å£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@700&display=swap');
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background-color: #FFFFFF; 
            font-weight: bold; 
            font-size: 18px; 
        }
        .input-field { width: 100%; padding: 1rem; margin-bottom: 1rem; border: 2px solid #F3F4F6; border-radius: 1.25rem; outline: none; }
        .card-container { border: 2px solid #F3F4F6; padding: 2rem; border-radius: 36px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-blue { background-color: #60A5FA; color: white; padding: 1rem; border-radius: 1.25rem; width: 100%; transition: 0.3s; }
        .btn-zoom { background-color: #2D8CFF; color: white; padding: 1.25rem; border-radius: 1.25rem; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-red { background-color: #F87171; color: white; padding: 1rem; border-radius: 1.25rem; width: 100%; }
        .btn-gold { background-color: #FBBF24; color: white; padding: 1rem; border-radius: 1.25rem; width: 100%; margin-top: 10px; }
        .warning-label { background-color: #EF4444; color: white; padding: 4px 12px; border-radius: 8px; font-size: 14px; margin-bottom: 8px; display: inline-block; }
        .negative-count { color: #EF4444 !important; }
    </style>
</head>
<body class="p-6">

    <div class="max-w-md mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-2xl font-bold text-gray-800">å°ç‹¸è€å¸«æ•´ç†</h1>
        </header>

        <div id="login-box" class="card-container">
            <h2 class="text-xl mb-6 text-center text-gray-700">å­¸å“¡ç™»å…¥</h2>
            <input type="email" id="login-email" placeholder="æ‚¨çš„ Email" class="input-field text-center font-bold">
            <button onclick="checkStatus()" id="login-btn" class="btn-blue shadow-lg font-bold">é€²å…¥ç³»çµ±</button>
            <p class="text-[14px] text-gray-400 mt-4 text-center">è«‹è¼¸å…¥å ±åæ™‚ä½¿ç”¨çš„ Email</p>
        </div>

        <div id="status-box" class="hidden">
            <div class="card-container border-blue-400 bg-blue-50/30 mb-6 text-center">
                <button onclick="enterZoom()" class="btn-zoom shadow-xl text-xl font-bold">ğŸ“¹ é€²å…¥ Zoom æ•™å®¤</button>
                <p class="text-[12px] text-blue-400 mt-2 font-normal">æœƒè­°å¯†ç¢¼: 45678</p>
            </div>

            <div class="card-container mb-6 text-center relative">
                <div class="absolute top-4 right-4 text-xs text-red-500">æœŸé™ï¼š<span id="res-expiry">---</span></div>
                <div class="text-xs text-blue-500 mb-2 text-left">å­¸å“¡ï¼š<span id="res-name">---</span></div>
                <p class="text-gray-500 mb-1">å‰©é¤˜èª²ç¨‹å ‚æ•¸</p>
                <div class="text-7xl text-blue-600 mb-4 font-bold" id="res-rem">0</div>
                <div id="debt-msg" class="text-red-500 text-sm hidden mb-4">âš ï¸ æé†’ï¼šç›®å‰èª²ç¨‹å·²æ¬ è²»ï¼Œè«‹è¨˜å¾—çºŒè²»</div>
                
                <div class="mt-4 pt-6 border-t border-gray-100">
                    <div class="warning-label">â›” è€å¸«å°ˆå€ (å­¸ç”Ÿè«‹å‹¿é»æ“Š)</div>
                    <button onclick="modifyLesson('deduct')" id="deduct-btn" class="btn-red shadow-lg text-sm mb-2 font-bold">æ‰‹å‹•æ‰£é™¤ä¸€å ‚èª²</button>
                    <button onclick="modifyLesson('add_lesson')" id="add-btn" class="btn-gold shadow-lg text-sm font-bold">ğŸ çå‹µåŠ èª²ä¸€å ‚</button>
                </div>
            </div>

            <div class="card-container mb-6">
                <h3 class="mb-4 text-blue-500">ğŸ’° çºŒè²»/ç¹³è²»å›å ±</h3>
                <div class="text-[14px] bg-gray-50 p-4 rounded-2xl mb-4 text-gray-700 font-normal border border-gray-100 text-left">
                    <span class="font-bold text-blue-800">ã€å°ç‹¸æ—¥èªèª²ç¨‹ãƒ¼è½‰å¸³è³‡è¨Šã€‘</span><br>
                    éŠ€è¡Œåç¨±ï¼šåœ‹æ³°ä¸–è¯ (013)<br>
                    è½‰å¸³å¸³è™Ÿï¼š075-50-608879-8
                </div>
                <input type="number" id="report-amount" class="input-field font-bold" placeholder="ç¹³è²»é‡‘é¡">
                <input type="text" id="report-five" class="input-field font-bold" placeholder="æœ«äº”ç¢¼">
                <button onclick="submitPayment()" id="report-btn" class="w-full bg-green-400 text-white py-4 rounded-2xl shadow-md font-bold">æäº¤å›å ±è³‡æ–™</button>
            </div>
            
            <button onclick="logout()" class="w-full text-gray-400 text-sm underline text-center font-normal">ç™»å‡ºç³»çµ±</button>
        </div>
    </div>

    <script>
        const GAS_URL = "https://script.google.com/macros/s/AKfycbz-i8X5_Ekbz6fWE0LO9HWtPyXsvxPpYL0Moq2eGUUIgtCjdqEE_nED14Ui2DR9aXRZ/exec"; 
        const ZOOM_LINK = "https://zoom.us/j/93019761780"; 

        window.onload = function() {
            const savedEmail = localStorage.getItem('korri_student_email');
            if (savedEmail) { document.getElementById('login-email').value = savedEmail; }
        };

        async function checkStatus() {
            const email = document.getElementById('login-email').value.trim();
            if(!email) return alert("è«‹è¼¸å…¥ Email");
            const btn = document.getElementById('login-btn');
            btn.innerText = "é©—è­‰ä¸­...";
            try {
                const res = await fetch(`${GAS_URL}?email=${encodeURIComponent(email)}`);
                const data = await res.json();
                if(data.status === "success") {
                    localStorage.setItem('korri_student_email', email);
                    const rem = data.remaining;
                    const remDisplay = document.getElementById('res-rem');
                    remDisplay.innerText = rem;
                    
                    if(rem < 0) {
                        remDisplay.classList.add('negative-count');
                        document.getElementById('debt-msg').classList.remove('hidden');
                    } else {
                        remDisplay.classList.remove('negative-count');
                        document.getElementById('debt-msg').classList.add('hidden');
                    }

                    document.getElementById('res-name').innerText = data.name;
                    document.getElementById('res-expiry').innerText = data.expiry;
                    document.getElementById('login-box').classList.add('hidden');
                    document.getElementById('status-box').classList.remove('hidden');
                } else { alert("æŸ¥ç„¡æ­¤ Emailï¼Œè«‹ç¢ºèªå ±åè³‡æ–™æ˜¯å¦æ­£ç¢º"); }
            } catch (e) { alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– GAS æ¬Šé™"); }
            btn.innerText = "é€²å…¥ç³»çµ±";
        }

        async function modifyLesson(action) {
            const email = localStorage.getItem('korri_student_email');
            const msg = action === 'deduct' ? "ã€è€å¸«ç¢ºèªã€‘è¦æ‰£é™¤ä¸€å ‚èª²å—ï¼Ÿ" : "ã€è€å¸«ç¢ºèªã€‘è¦çå‹µä¸€å ‚èª²å—ï¼Ÿ";
            if(!confirm(msg)) return;
            const res = await fetch(`${GAS_URL}?email=${encodeURIComponent(email)}&action=${action}`);
            const data = await res.json();
            if(data.status === "success") { alert("æ›´æ–°æˆåŠŸï¼"); checkStatus(); }
        }

        async function enterZoom() {
            const email = localStorage.getItem('korri_student_email');
            fetch(`${GAS_URL}?email=${encodeURIComponent(email)}&action=zoom_checkin`);
            window.open(ZOOM_LINK, '_blank');
        }

        async function submitPayment() {
            const email = localStorage.getItem('korri_student_email');
            const amount = document.getElementById('report-amount').value;
            const five = document.getElementById('report-five').value;
            if(!amount || !five) return alert("è«‹å¡«å¯«é‡‘é¡èˆ‡æœ«äº”ç¢¼");
            try {
                await fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    body: JSON.stringify({ email, amount, lastFive: five, name: document.getElementById('res-name').innerText })
                });
                alert("å›å ±æˆåŠŸï¼å°ç‹¸è€å¸«æ ¸å°å¾Œæœƒæ‰‹å‹•æ›´æ–°æ‚¨çš„å ‚æ•¸ã€‚");
            } catch (e) { alert("æäº¤å¤±æ•—"); }
        }

        function logout() { localStorage.removeItem('korri_student_email'); location.reload(); }
    </script>
</body>
</html>
